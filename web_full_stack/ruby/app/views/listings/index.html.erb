<% if @categories.present? %>
  <%= form_tag(listings_path, method: :get) do -%>
    <div class="form-group">
      <label for="category">Filter By Category</label>
      <select name="category">
        <option value="">All Categories</option>
        <% @categories.each do |category| %>
          <option value="<%= category['uuid'] %>">
            <%= category['full_name'] %>
          </option>
        <% end %>
      </select>
    </div>

    <div class="form-group">
      <button type="submit" class="btn btn-primary">Apply Filter</button>
    </div>
  <% end %>
<% end %>

<% if @listings.present? %>

  <% if @current_page > 1 %>
    <%= form_tag(listings_path, method: :get) do -%>
      <div class="form-group">
        <input name="category" type="hidden" value="<%= @selected_category %>"/>
        <input name="page" type="hidden" value="<%= @current_page - 1 %>"/>
        <button type="submit" class="btn btn-primary">Previous Page</button>
      </div>
    <% end %>
  <% end %>
  <% if @current_page < @total_pages %>
    <%= form_tag(listings_path, method: :get) do -%>
      <div class="form-group">
        <input name="category" type="hidden" value="<%= @selected_category %>"/>
        <input name="page" type="hidden" value="<%= @current_page + 1 %>"/>
        <button type="submit" class="btn btn-primary">Next Page</button>
      </div>
    <% end %>
  <% end %>

  <h2>Listings</h2>
  <ul class="list-group">
    <% @listings.each do |listing| %>
      <li class="d-flex list-group-item flex-row align-items-center">
        <div class="p-2">
            <%= image_tag(listing['photos'].first['_links']['thumbnail']['href'] )%>
        </div>
        <h2 class="p-2">
            <%= listing['title'] %>
        </h2>
      </li>
    <% end %>
  </ul>
<% end %>
